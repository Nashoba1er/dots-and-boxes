name: CI for Dots and Boxes

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  # Job pour tester sur plusieurs versions de Python
  test:
    runs-on: ubuntu-latest  # Utilise un environnement Ubuntu pour exécuter les tests

    strategy:
      matrix:
        python-version: [3.8, 3.9, 3.10]  # Teste sur plusieurs versions de Python

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    # Installer Poetry
    - name: Set up Poetry
      uses: python-actions/setup-poetry@v2
      with:
        python-version: ${{ matrix.python-version }}  # Installe la version de Python de la matrice

    # Installer les dépendances avec Poetry
    - name: Install dependencies
      run: |
        poetry install

    # Exécuter les tests unitaires
    - name: Run unit tests
      run: |
        poetry run python -m unittest discover

  # Job pour l'analyse statique du code avec Flake8
  flake8:
    runs-on: ubuntu-latest  # Utilise un environnement Ubuntu

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    # Installer Poetry et Flake8
    - name: Set up Poetry
      uses: python-actions/setup-poetry@v2
      with:
        python-version: 3.11  # Utilise la version 3.11 pour l'analyse statique

    - name: Install dependencies and Flake8
      run: |
        poetry install
        poetry run pip install flake8  # Installer Flake8 via Poetry

    # Exécuter Flake8 pour l'analyse statique du code
    - name: Run Flake8
      run: |
        poetry run flake8 .  # Lancer Flake8 sur tout le projet

  # Job pour vérifier la présence de secrets dans le code
  git-secrets:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install Git Secrets
      run: |
        sudo apt-get install -y git-secrets
        git secrets --register-aws
        git secrets --install

    - name: Run Git Secrets
      run: |
        git secrets --scan  # Vérifier la présence de secrets dans les commits
